<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="ReactNative," />





  <link rel="alternate" href="/atom.xml" title="CaelumTian的博客" type="application/atom+xml" />






<meta name="description" content="本章主要来探讨一下，RN 的启动过程都做了什么？同时简单的介绍下在 Android 中是如何实现 ReactNative 的。进而引出解决一个重要的问题，ReactNative 的预加载。">
<meta name="keywords" content="ReactNative">
<meta property="og:type" content="article">
<meta property="og:title" content="ReactNative 详解(四) 源码之RN启动过程">
<meta property="og:url" content="http://yoursite.com/2018/11/03/ReactNative基础4/index.html">
<meta property="og:site_name" content="CaelumTian的博客">
<meta property="og:description" content="本章主要来探讨一下，RN 的启动过程都做了什么？同时简单的介绍下在 Android 中是如何实现 ReactNative 的。进而引出解决一个重要的问题，ReactNative 的预加载。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2018/11/03/ReactNative基础4/a.png">
<meta property="og:updated_time" content="2019-04-21T11:28:21.271Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ReactNative 详解(四) 源码之RN启动过程">
<meta name="twitter:description" content="本章主要来探讨一下，RN 的启动过程都做了什么？同时简单的介绍下在 Android 中是如何实现 ReactNative 的。进而引出解决一个重要的问题，ReactNative 的预加载。">
<meta name="twitter:image" content="http://yoursite.com/2018/11/03/ReactNative基础4/a.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/03/ReactNative基础4/"/>





  <title>ReactNative 详解(四) 源码之RN启动过程 | CaelumTian的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CaelumTian的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">你若盛开，清风自来，心若沉浮 浅笑安然</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/03/ReactNative基础4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CaelumTian">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CaelumTian的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ReactNative 详解(四) 源码之RN启动过程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-03T16:14:59+08:00">
                2018-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/大前端-无线/" itemprop="url" rel="index">
                    <span itemprop="name">大前端(无线)</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本章主要来探讨一下，RN 的启动过程都做了什么？同时简单的介绍下在 Android 中是如何实现 ReactNative 的。进而引出解决一个重要的问题，ReactNative 的预加载。</p>
<a id="more"></a>
<h2 id="ReactNative-系统框架概述"><a href="#ReactNative-系统框架概述" class="headerlink" title="ReactNative 系统框架概述"></a>ReactNative 系统框架概述</h2><p>ReactNative 源码结构图如下：</p>
<img src="/2018/11/03/ReactNative基础4/a.png" alt="a.png" title=""> 
<p>其中几个主要内容：</p>
<ul>
<li>Libraries：JS层的实现，实现了JS组件的封装与JS队列的封装</li>
<li>ReactAndroid：Android 源码实现</li>
<li>ReactCommon：C++ 层实现，实现了对脚本引擎JSC的封装与通信桥ReactBridge，Android与iOS调用</li>
<li>React：ReactNative源码的主要内容</li>
</ul>
<p>ReactNative 主要工作就两部分：<br>第一部分实现：ReactNative 应用启动流程；ReactNative应用UI的绘制与渲染；ReactNative应用通信机制；ReactNative应用线程模型<br>第二部分：ReactNative运行时的异常以及异常的捕获与处理；SOLoader加载动态链接库；ReactNative触摸事件处理机制。</p>
<p>我们先从一个 Demo 工程来看 ReactNative 启动流程</p>
<h2 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h2><h3 id="应用初始化"><a href="#应用初始化" class="headerlink" title="应用初始化"></a>应用初始化</h3><p>首先，我们打开这个普通工程的 <code>android</code> 目录，这里就是一个完整的 android 项目。</p>
<ol>
<li>首先我们看 <code>MainApplication.java</code> 里面的 RN 的初始化操作</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> <span class="keyword">implements</span> <span class="title">ReactApplication</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ReactNativeHost mReactNativeHost = <span class="keyword">new</span> ReactNativeHost(<span class="keyword">this</span>) &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getUseDeveloperSupport</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> BuildConfig.DEBUG;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> List&lt;ReactPackage&gt; <span class="title">getPackages</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> Arrays.&lt;ReactPackage&gt;asList(</div><div class="line">          <span class="keyword">new</span> MainReactPackage()</div><div class="line">      );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getJSMainModuleName</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="string">"index"</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> ReactNativeHost <span class="title">getReactNativeHost</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> mReactNativeHost;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate();</div><div class="line">    <span class="comment">// SoLoader 加载</span></div><div class="line">    SoLoader.init(<span class="keyword">this</span>, <span class="comment">/* native exopackage */</span> <span class="keyword">false</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>ReactApplication</code> 可以看到我们在Application里实现了 ReactApplication接口，该接口要求创建一个ReactNativeHost对象。ReactNativeHost 对象，本身持有 <code>ReactInstanceManager</code> 对象。其对外暴露两个需要实现的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//是否开启dev模式，dev模式下会有一些调试工具</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">getUseDeveloperSupport</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// 返回app需要的ReactPackage，这些ReactPackage里包含了运行时需要用到的NativeModule</span></div><div class="line"><span class="comment">// JavaScriptModule以及ViewManager</span></div><div class="line"><span class="comment">// 我们的自定义 Module 也是在这里添加的</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> List&lt;ReactPackage&gt; <span class="title">getPackages</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<p>ReactNativeHost主要的工作就是创建 ReactInstanceManager，创建部分代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactNativeHost</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">protected</span> ReactInstanceManager <span class="title">createReactInstanceManager</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// Builder 模式，创建 ReactInstanceManager 实例</span></div><div class="line">    ReactInstanceManagerBuilder builder = ReactInstanceManager.builder()</div><div class="line">      <span class="comment">// 设置应用上下文</span></div><div class="line">      .setApplication(mApplication)</div><div class="line">      <span class="comment">// 设置应用的 jsBundle，可以传给 url 来使其从服务器拉去 jsBundle</span></div><div class="line">      <span class="comment">// 仅在 dev 下生效</span></div><div class="line">      .setJSMainModulePath(getJSMainModuleName())</div><div class="line">      <span class="comment">// 是否开启 dev 模式</span></div><div class="line">      .setUseDeveloperSupport(getUseDeveloperSupport())</div><div class="line">      <span class="comment">// 红盒回调</span></div><div class="line">      .setRedBoxHandler(getRedBoxHandler())</div><div class="line">      .setJavaScriptExecutorFactory(getJavaScriptExecutorFactory())</div><div class="line">      <span class="comment">// 自定义UI实现机制，不会使用</span></div><div class="line">      .setUIImplementationProvider(getUIImplementationProvider())</div><div class="line">      .setJSIModulesPackage(getJSIModulePackage())</div><div class="line">      .setInitialLifecycleState(LifecycleState.BEFORE_CREATE);</div><div class="line"></div><div class="line">    <span class="comment">// 添加ReactPackage (就是我们复写的抽象方法)</span></div><div class="line">    <span class="keyword">for</span> (ReactPackage reactPackage : getPackages()) &#123;</div><div class="line">      builder.addPackage(reactPackage);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//获取js Bundle的加载路径</span></div><div class="line">    String jsBundleFile = getJSBundleFile();</div><div class="line">    <span class="keyword">if</span> (jsBundleFile != <span class="keyword">null</span>) &#123;</div><div class="line">      builder.setJSBundleFile(jsBundleFile);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      builder.setBundleAssetName(Assertions.assertNotNull(getBundleAssetName()));</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 创建</span></div><div class="line">    ReactInstanceManager reactInstanceManager = builder.build();</div><div class="line">    ReactMarker.logMarker(ReactMarkerConstants.BUILD_REACT_INSTANCE_MANAGER_END);</div><div class="line">    <span class="keyword">return</span> reactInstanceManager;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>接下来看 MainActivity.java </li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ReactActivity</span> </span>&#123;</div><div class="line">    @Override</div><div class="line">    protected <span class="built_in">String</span> getMainComponentName() &#123;</div><div class="line">        <span class="comment">// 返回组件名</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"TestDemo"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里我们的 MainActivity 继承自 <code>ReactActivity</code>，ReactActivity作为JS页面的容器。最后我们的前端界面的内容，就是渲染到了这个容器上面。（ReactActivity 后面介绍）</p>
<h3 id="应用启动流程"><a href="#应用启动流程" class="headerlink" title="应用启动流程"></a>应用启动流程</h3><p>我们开始分析 <code>ReactActivity</code>。<code>ReactAcivity</code> 本身继承自 Activity，并实现了其生命周期。本质上其什么也没有做，都是委托给了 <code>ReactActivityDelegate</code>。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></div><div class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">DefaultHardwareBackBtnHandler</span>, <span class="title">PermissionAwareActivity</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ReactActivityDelegate mDelegate;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">ReactActivity</span><span class="params">()</span> </span>&#123;</div><div class="line">        mDelegate = createReactActivityDelegate();</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 获取渲染的 RN 组件名称</span></div><div class="line">    <span class="keyword">protected</span> <span class="meta">@Nullable</span> <span class="function">String <span class="title">getMainComponentName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> ReactActivityDelegate <span class="title">createReactActivityDelegate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ReactActivityDelegate(<span class="keyword">this</span>, getMainComponentName());</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        <span class="comment">// 委托给 ReactActivityDelegate 来实现</span></div><div class="line">        mDelegate.onCreate(savedInstanceState);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其本身所有行为都交给了 <code>ReactActivityDelegate</code> 来处理，我们只需要关心 <code>ReactActivityDelegate</code> 即可。 </p>
<h4 id="ReactActivityDelegate"><a href="#ReactActivityDelegate" class="headerlink" title="ReactActivityDelegate"></a>ReactActivityDelegate</h4><p>我们先来看，ReactActivity 的 <code>onCreate</code> 方法，本质上映射到了 <code>ReactActivityDelegate</code> 的 onCreate。</p>
<h5 id="ReactActivityDelegate-onCreate-Bundle-savedInstanceState"><a href="#ReactActivityDelegate-onCreate-Bundle-savedInstanceState" class="headerlink" title="ReactActivityDelegate.onCreate(Bundle savedInstanceState)"></a>ReactActivityDelegate.onCreate(Bundle savedInstanceState)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactActivityDelegate</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReactActivityDelegate</span><span class="params">(Activity activity, @Nullable String mainComponentName)</span> </span>&#123;</div><div class="line">        mActivity = activity;</div><div class="line">        mMainComponentName = mainComponentName;</div><div class="line">        mFragmentActivity = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mMainComponentName != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// 载入 app 页面</span></div><div class="line">            loadApp(mMainComponentName);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// ...开发调试配置</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">loadApp</span><span class="params">(String appKey)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mReactRootView != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Cannot loadApp while app is already running."</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 创建ReactRootView作为根视图 ,它本质上是一个FrameLayout</span></div><div class="line">        mReactRootView = createRootView();</div><div class="line">        <span class="comment">// 启动应用程序</span></div><div class="line">        mReactRootView.startReactApplication(</div><div class="line">            getReactNativeHost().getReactInstanceManager(),</div><div class="line">            appKey,</div><div class="line">            getLaunchOptions());</div><div class="line">        <span class="comment">// mActivity.setContentView</span></div><div class="line">        getPlainActivity().setContentView(mReactRootView);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建阶段主要了做了如下几个事情：</p>
<ol>
<li>创建ReactRootView作为应用的容器，它本质上是一个FrameLayout。</li>
<li>调用ReactRootView.startReactApplication()进一步执行应用启动流程。</li>
<li>调用Activity.setContentView() 将创建的 ReactRootView 作为 ReactActivity的content view。</li>
</ol>
<p>所以呢，RN 其实被渲染到了一个 <code>ReactRootView</code> 上面，他可以被用在 Android 任何地方（比如 RN 视图和 原生视图组合）。接下来我们看启动过程 <code>startReactApplication</code>。</p>
<h5 id="ReactRootView-startReactApplication-ReactInstanceManager-reactInstanceManager-String-moduleName-Nullable-Bundle-launchOptions"><a href="#ReactRootView-startReactApplication-ReactInstanceManager-reactInstanceManager-String-moduleName-Nullable-Bundle-launchOptions" class="headerlink" title="ReactRootView.startReactApplication(ReactInstanceManager reactInstanceManager, String moduleName, @Nullable Bundle launchOptions)"></a>ReactRootView.startReactApplication(ReactInstanceManager reactInstanceManager, String moduleName, @Nullable Bundle launchOptions)</h5><p>简要代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactRootView</span> <span class="keyword">extends</span> <span class="title">SizeMonitoringFrameLayout</span></span></div><div class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">RootView</span>, <span class="title">MeasureSpecProvide</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startReactApplication</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">        ReactInstanceManager reactInstanceManager,</span></span></div><div class="line"><span class="function"><span class="params">        String moduleName,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable Bundle initialProperties,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable String initialUITemplate)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// 判断是否运行在主线程上</span></div><div class="line">            UiThreadUtil.assertOnUiThread();</div><div class="line">            mReactInstanceManager = reactInstanceManager;</div><div class="line">            mJSModuleName = moduleName;</div><div class="line">            mAppProperties = initialProperties;</div><div class="line">            mInitialUITemplate = initialUITemplate;</div><div class="line"></div><div class="line">            <span class="comment">// 创建RN应用上下文</span></div><div class="line">            <span class="keyword">if</span> (!mReactInstanceManager.hasStartedCreatingInitialContext()) &#123;</div><div class="line">                mReactInstanceManager.createReactContextInBackground();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            attachToReactInstanceManager();</div><div class="line"></div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参数信息：</p>
<ul>
<li>ReactInstanceManager reactInstanceManager：ReactInstanceManager 实例</li>
<li>String moduleName：模块的名字，对应ReactActivity.getMainComponentName()与AppRegistry.registerComponent()</li>
<li>Bundle launchOptions：Bundle 类型，可以在 startActivity 时候传递参数到 JS 层</li>
</ul>
<p>（UiThreadUtil 主要包装了两个方法：UiThreadUtil.isOnUiThread()，UiThreadUtil.runOnUiThread(Runnable runnable)）</p>
<p>主要还是调用了 ReactInstanceManager 上的 <code>createReactContextInBackground</code> 方法。</p>
<h5 id="ReactInstanceManager-createReactContextInBackground"><a href="#ReactInstanceManager-createReactContextInBackground" class="headerlink" title="ReactInstanceManager.createReactContextInBackground()"></a>ReactInstanceManager.createReactContextInBackground()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactInstanceManager</span> </span>&#123;</div><div class="line"> <span class="comment">/**</span></div><div class="line"><span class="comment">  * Trigger react context initialization asynchronously in a background async task. This enables</span></div><div class="line"><span class="comment">  * applications to pre-load the application JS, and execute global code before</span></div><div class="line"><span class="comment">  * &#123;<span class="doctag">@link</span> ReactRootView&#125; is available and measured. This should only be called the first time the</span></div><div class="line"><span class="comment">  * application is set up, which is enforced to keep developers from accidentally creating their</span></div><div class="line"><span class="comment">  * application multiple times without realizing it.</span></div><div class="line"><span class="comment">  *</span></div><div class="line"><span class="comment">  * Called from UI thread.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"> <span class="meta">@ThreadConfined</span>(UI)</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createReactContextInBackground</span><span class="params">()</span> </span>&#123;</div><div class="line">    Log.d(ReactConstants.TAG, <span class="string">"ReactInstanceManager.createReactContextInBackground()"</span>);</div><div class="line">    Assertions.assertCondition(</div><div class="line">        !mHasStartedCreatingInitialContext,</div><div class="line">        <span class="string">"createReactContextInBackground should only be called when creating the react "</span> +</div><div class="line">            <span class="string">"application for the first time. When reloading JS, e.g. from a new file, explicitly"</span> +</div><div class="line">            <span class="string">"use recreateReactContextInBackground"</span>);</div><div class="line"></div><div class="line">    mHasStartedCreatingInitialContext = <span class="keyword">true</span>;</div><div class="line">    recreateReactContextInBackgroundInner();</div><div class="line">  &#125;</div><div class="line">  <span class="meta">@ThreadConfined</span>(UI)</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recreateReactContextInBackgroundInner</span><span class="params">()</span> </span>&#123;</div><div class="line">    UiThreadUtil.assertOnUiThread();</div><div class="line"></div><div class="line">    <span class="comment">// 这里有一大堆代码，都是在开发模式下在线更新 bundle (mDevSupportManager.handleReloadJS())，调用开发菜单等调试功能的地方</span></div><div class="line">    <span class="comment">// 但是实际上都调用到了 下面那句话</span></div><div class="line">    <span class="keyword">if</span> (mUseDeveloperSupport &amp;&amp; mJSMainModulePath != <span class="keyword">null</span>) &#123;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 线上模式</span></div><div class="line">    recreateReactContextInBackgroundFromBundleLoader();</div><div class="line">  &#125;</div><div class="line">  <span class="meta">@ThreadConfined</span>(UI)</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recreateReactContextInBackgroundFromBundleLoader</span><span class="params">()</span> </span>&#123;</div><div class="line">    recreateReactContextInBackground(mJavaScriptExecutorFactory, mBundleLoader);</div><div class="line">  &#125;</div><div class="line">  <span class="meta">@ThreadConfined</span>(UI)</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recreateReactContextInBackground</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">    JavaScriptExecutorFactory jsExecutorFactory,</span></span></div><div class="line"><span class="function"><span class="params">    JSBundleLoader jsBundleLoader)</span> </span>&#123;</div><div class="line">    UiThreadUtil.assertOnUiThread();</div><div class="line"></div><div class="line">    <span class="comment">// ReactContextInitParams 类就是实现了一个断言，两个参数必须有</span></div><div class="line">    <span class="keyword">final</span> ReactContextInitParams initParams = <span class="keyword">new</span> ReactContextInitParams(</div><div class="line">      jsExecutorFactory,</div><div class="line">      jsBundleLoader);</div><div class="line">    <span class="keyword">if</span> (mCreateReactContextThread == <span class="keyword">null</span>) &#123;</div><div class="line">      <span class="comment">// 初始化一个异步任务，创建 ReactContextInitAsyncTask</span></div><div class="line">      runCreateReactContextOnNewThread(initParams);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="comment">// 创建ReactContext的后台任务已经开启，缓存initParams在队列中等待重新创建ReactContext</span></div><div class="line">      mPendingReactContextInitParams = initParams;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ReactContextInitParams</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">    JavaScriptExecutorFactory jsExecutorFactory,</span></span></div><div class="line"><span class="function"><span class="params">    JSBundleLoader jsBundleLoader)</span> </span>&#123;</div><div class="line">    mJsExecutorFactory = Assertions.assertNotNull(jsExecutorFactory);</div><div class="line">    mJsBundleLoader = Assertions.assertNotNull(jsBundleLoader);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里创建过程从上到下执行，最后调用到 <code>runCreateReactContextOnNewThread</code>。该方法实际上就是新启了一个线程，来执行如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> ReactApplicationContext reactApplicationContext =</div><div class="line">                    createReactContext(</div><div class="line">                        initParams.getJsExecutorFactory().create(),</div><div class="line">                        initParams.getJsBundleLoader());</div><div class="line"><span class="comment">// 如果创建完毕 createContext 则回调这个线程</span></div><div class="line">Runnable setupReactContextRunnable =</div><div class="line">                      <span class="keyword">new</span> Runnable() &#123;</div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                          <span class="keyword">try</span> &#123;</div><div class="line">                            setupReactContext(reactApplicationContext);</div><div class="line">                          &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                            mDevSupportManager.handleException(e);</div><div class="line">                          &#125;</div><div class="line">                        &#125;</div><div class="line">                      &#125;;</div><div class="line"><span class="comment">// c++ 层回调</span></div><div class="line">                  reactApplicationContext.runOnNativeModulesQueueThread(setupReactContextRunnable);</div><div class="line">``` </div><div class="line"></div><div class="line">完成 ReactApplicationContext 的创建。我们看传入的两个参数：</div><div class="line"></div><div class="line">* JsExecutorFactory jsExecutor：当该类被加载时，它会自动去加载<span class="string">"reactnativejnifb.so"</span>库，并会调用 Native 方</div><div class="line">法 initHybrid() 初始化 C++层 RN 与 JSC通信的框架。</div><div class="line">* JSBundleLoader jsBundleLoader：缓存了JSBundle的信息，封装了上层加载JSBundle的相关接口，CatalystInstance通过其间接调用ReactBridge 去加载J S文件，不同的场景会创建不同的加载器，具体可以查看类JSBundleLoader。</div><div class="line"></div><div class="line"></div><div class="line">##### ReactInstanceManager.createReactContext( JavaScriptExecutor jsExecutor, JSBundleLoader jsBundleLoader)</div><div class="line">简要代码如下</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">```java</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactInstanceManager</span> </span>&#123;</div><div class="line">      <span class="function"><span class="keyword">private</span> ReactApplicationContext <span class="title">createReactContext</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">      JavaScriptExecutor jsExecutor,</span></span></div><div class="line"><span class="function"><span class="params">      JSBundleLoader jsBundleLoader)</span> </span>&#123;</div><div class="line">    <span class="comment">// ReactApplicationContext 是 ReactContext的包装类。实际上调用的就是 ReactContext。</span></div><div class="line">    <span class="keyword">final</span> ReactApplicationContext reactContext = <span class="keyword">new</span> ReactApplicationContext(mApplicationContext);</div><div class="line"></div><div class="line">    NativeModuleCallExceptionHandler exceptionHandler = mNativeModuleCallExceptionHandler != <span class="keyword">null</span></div><div class="line">        ? mNativeModuleCallExceptionHandler</div><div class="line">        : mDevSupportManager;</div><div class="line">    reactContext.setNativeModuleCallExceptionHandler(exceptionHandler);</div><div class="line">    <span class="comment">// 创建 JavaModule 注册表Builder，用来创建JavaModule注册表，JavaModule注册表将所有的JavaModule注册到CatalystInstance中。</span></div><div class="line">    <span class="comment">// mPackages 就是 ReactNativeHost 那里 getPackages 的各种模块 ReactPackage</span></div><div class="line">    NativeModuleRegistry nativeModuleRegistry = processPackages(reactContext, mPackages, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 创建 CatalystInstance </span></div><div class="line">    CatalystInstanceImpl.Builder catalystInstanceBuilder = <span class="keyword">new</span> CatalystInstanceImpl.Builder()</div><div class="line">      .setReactQueueConfigurationSpec(ReactQueueConfigurationSpec.createDefault())</div><div class="line">      .setJSExecutor(jsExecutor)</div><div class="line">      .setRegistry(nativeModuleRegistry)</div><div class="line">      .setJSBundleLoader(jsBundleLoader)</div><div class="line">      .setNativeModuleCallExceptionHandler(exceptionHandler);</div><div class="line"></div><div class="line">    <span class="keyword">final</span> CatalystInstance catalystInstance;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      catalystInstance = catalystInstanceBuilder.build();</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">      Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</div><div class="line">      ReactMarker.logMarker(CREATE_CATALYST_INSTANCE_END);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (mJSIModulePackage != <span class="keyword">null</span>) &#123;</div><div class="line">      catalystInstance.addJSIModules(mJSIModulePackage</div><div class="line">        .getJSIModules(reactContext, catalystInstance.getJavaScriptContextHolder()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (mBridgeIdleDebugListener != <span class="keyword">null</span>) &#123;</div><div class="line">      catalystInstance.addBridgeIdleDebugListener(mBridgeIdleDebugListener);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 通过CatalystInstance开始加载JS Bundle</span></div><div class="line">    <span class="comment">// runJSBundle 在 CatalysInstanceImp 中</span></div><div class="line">    catalystInstance.runJSBundle();</div><div class="line">    <span class="comment">// 关联ReacContext与CatalystInstance</span></div><div class="line">    reactContext.initializeWithInstance(catalystInstance);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">return</span> reactContext;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>主要创建 JavaModule 表，交给 CatalystInstance 管理</li>
<li>处理ReactPackage，将JavaModule与JavaScriptModule放进各自对应的注册表里。</li>
<li>通过上面jsExecutor、nativeModuleRegistry、jsModulesRegistry、jsBundleLoader、exceptionHandler等参数创建CatalystInstance实例。</li>
<li>关联 ReactContext 与 CatalystInstance，并将JS Bundle加载进来，等待ReactContextInitAsyncTask结束以后调用JS入口渲染页面。</li>
<li>最后调用 CatalystInstance.runJSBundle()去加载 JS Bundle</li>
</ol>
<p>最终由 C++ 中的JSCExecutor.cpp 完成了 JS Bundle 的加载。<br>这里起到作用的就是 <code>CatalystInstance</code> 他由 CatalystInstanceImpl 构造而成。查看代码：</p>
<h4 id="CatalystInstanceImpl"><a href="#CatalystInstanceImpl" class="headerlink" title="CatalystInstanceImpl"></a>CatalystInstanceImpl</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CatalystInstanceImpl</span> <span class="keyword">implements</span> <span class="title">CatalystInstance</span> </span>&#123;</div><div class="line">  <span class="comment">// C++ parts</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> HybridData mHybridData;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">static</span> HybridData <span class="title">initHybrid</span><span class="params">()</span></span>;</div><div class="line">  <span class="comment">// 在C++层初始化通信桥ReactBridge</span></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">initializeBridge</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">      ReactCallback callback,</span></span></div><div class="line"><span class="function"><span class="params">      JavaScriptExecutor jsExecutor,</span></span></div><div class="line"><span class="function"><span class="params">      MessageQueueThread jsQueue,</span></span></div><div class="line"><span class="function"><span class="params">      MessageQueueThread moduleQueue,</span></span></div><div class="line"><span class="function"><span class="params">      Collection&lt;JavaModuleWrapper&gt; javaModules,</span></span></div><div class="line"><span class="function"><span class="params">      Collection&lt;ModuleHolder&gt; cxxModules)</span></span>;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">CatalystInstanceImpl</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">    <span class="keyword">final</span> ReactQueueConfigurationSpec reactQueueConfigurationSpec,</span></span></div><div class="line"><span class="function"><span class="params">    <span class="keyword">final</span> JavaScriptExecutor jsExecutor,</span></span></div><div class="line"><span class="function"><span class="params">    <span class="keyword">final</span> NativeModuleRegistry nativeModuleRegistry,</span></span></div><div class="line"><span class="function"><span class="params">    <span class="keyword">final</span> JSBundleLoader jsBundleLoader,</span></span></div><div class="line"><span class="function"><span class="params">    NativeModuleCallExceptionHandler nativeModuleCallExceptionHandler)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// Native方法，用来创建JNI相关状态，并返回mHybridData。</span></div><div class="line">    mHybridData = initHybrid();</div><div class="line">    <span class="comment">// RN中的三个线程：Native Modules Thread、JS Thread、UI Thread，都是通过Handler来管理的。</span></div><div class="line">    mReactQueueConfiguration = ReactQueueConfigurationImpl.create(</div><div class="line">        reactQueueConfigurationSpec,</div><div class="line">        <span class="keyword">new</span> NativeExceptionHandler());</div><div class="line">    mBridgeIdleListeners = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</div><div class="line">    mNativeModuleRegistry = nativeModuleRegistry;</div><div class="line">    mJSModuleRegistry = <span class="keyword">new</span> JavaScriptModuleRegistry();</div><div class="line">    mJSBundleLoader = jsBundleLoader;</div><div class="line">    mNativeModuleCallExceptionHandler = nativeModuleCallExceptionHandler;</div><div class="line">    mNativeModulesQueueThread = mReactQueueConfiguration.getNativeModulesQueueThread();</div><div class="line">    mTraceListener = <span class="keyword">new</span> JSProfilerTraceListener(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">// Native方法，调用initializeBridge()方法，并创建BridgeCallback实例，初始化Bridge。</span></div><div class="line">    initializeBridge(</div><div class="line">      <span class="keyword">new</span> BridgeCallback(<span class="keyword">this</span>),</div><div class="line">      jsExecutor,</div><div class="line">      mReactQueueConfiguration.getJSQueueThread(),</div><div class="line">      mNativeModulesQueueThread,</div><div class="line">      mNativeModuleRegistry.getJavaModules(<span class="keyword">this</span>),</div><div class="line">      mNativeModuleRegistry.getCxxModules());</div><div class="line"></div><div class="line">    mJavaScriptContextHolder = <span class="keyword">new</span> JavaScriptContextHolder(getJavaScriptContext());</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>ReactCallback callback：CatalystInstanceImpl的静态内部类ReactCallback，负责接口回调。</li>
<li>JavaScriptExecutor jsExecutor：JS执行器，将JS的调用传递给C++层。</li>
<li>MessageQueueThread jsQueue.getJSQueueThread()：JS线程，通过mReactQueueConfiguration.getJSQueueThread()获得，</li>
<li>Collection<javamodulewrapper> javaModules：java modules，来源于mJavaRegistry.getJavaModules(this)。</javamodulewrapper></li>
<li>Collection<moduleholder> cxxModules)：c++ modules，来源于mJavaRegistry.getCxxModules()。</moduleholder></li>
</ul>
<p>CatalystInstanceImpl 创建好，调用 runJSBundle 来加载js</p>
<h5 id="CatalystInstanceImpl-runJSBundle"><a href="#CatalystInstanceImpl-runJSBundle" class="headerlink" title="CatalystInstanceImpl.runJSBundle()"></a>CatalystInstanceImpl.runJSBundle()</h5><p>这个代码最后会调用，初始化创建 ReactInstanceManager -&gt; createReactContext 传入的 <code>JSBundleLoader bundleLoader</code> 上的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 调用加载器加载JS Bundle，不同情况下加载器各不相同。</span></div><div class="line">mJSBundleLoader.loadScript(CatalystInstanceImpl.<span class="keyword">this</span>);</div></pre></td></tr></table></figure>
<p>bundleLoader 由 <code>ReactInstanceManagerBuilder.setJSBundleFile(String jsBundleFile)</code> 创建而来 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public ReactInstanceManagerBuilder setJSBundleFile(<span class="built_in">String</span> jsBundleFile) &#123;</div><div class="line">    <span class="keyword">if</span> (jsBundleFile.startsWith(<span class="string">"assets://"</span>)) &#123;</div><div class="line">        mJSBundleAssetUrl = jsBundleFile;</div><div class="line">        mJSBundleLoader = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> setJSBundleLoader(JSBundleLoader.createFileLoader(jsBundleFile));</div><div class="line">&#125;</div><div class="line">public ReactInstanceManagerBuilder setJSBundleLoader(JSBundleLoader jsBundleLoader) &#123;</div><div class="line">    mJSBundleLoader = jsBundleLoader;</div><div class="line">    mJSBundleAssetUrl = <span class="literal">null</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>JSBundleLoader 提供了多种加载方案，通过 <code>ReactInstanceManagerBuilder.setJSBundleFile(String jsBundleFile)</code> 调用的加载器如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">JSBundleLoader</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JSBundleLoader <span class="title">createFileLoader</span><span class="params">(<span class="keyword">final</span> String fileName)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> createFileLoader(fileName, fileName, <span class="keyword">false</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JSBundleLoader <span class="title">createFileLoader</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">      <span class="keyword">final</span> String fileName,</span></span></div><div class="line"><span class="function"><span class="params">      <span class="keyword">final</span> String assetUrl,</span></span></div><div class="line"><span class="function"><span class="params">      <span class="keyword">final</span> <span class="keyword">boolean</span> loadSynchronously)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> JSBundleLoader() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> String <span class="title">loadScript</span><span class="params">(CatalystInstanceImpl instance)</span> </span>&#123;</div><div class="line">        instance.loadScriptFromFile(fileName, assetUrl, loadSynchronously);</div><div class="line">        <span class="keyword">return</span> fileName;</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line">  <span class="comment">/** Loads the script, returning the URL of the source it loaded. */</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">loadScript</span><span class="params">(CatalystInstanceImpl instance)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到，在这种加载器下，最后调用的是 <code>CatalystInstanceImpl</code> 上的 <code>loadScriptFromFile</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CatalystInstanceImpl</span> <span class="keyword">implements</span> <span class="title">CatalystInstance</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">jniLoadScriptFromFile</span><span class="params">(String fileName, String sourceURL, <span class="keyword">boolean</span> loadSynchronously)</span></span>;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">loadScriptFromFile</span><span class="params">(String fileName, String sourceURL, <span class="keyword">boolean</span> loadSynchronously)</span> </span>&#123;</div><div class="line">    mSourceURL = sourceURL;</div><div class="line">    <span class="comment">// C++ 方法</span></div><div class="line">    jniLoadScriptFromFile(fileName, sourceURL, loadSynchronously);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>CatalystInstanceImpl.java 最终还是调用C++层的 CatalystInstanceImpl.cpp去加载JS Bundle。</p>
<p>接下来就是 <code>C++</code> 部分了，不太会了呢。</p>
<h5 id="ReactInstanceManager-setupReactContext-final-ReactApplicationContext-reactContext"><a href="#ReactInstanceManager-setupReactContext-final-ReactApplicationContext-reactContext" class="headerlink" title="ReactInstanceManager.setupReactContext(final ReactApplicationContext reactContext)"></a>ReactInstanceManager.setupReactContext(final ReactApplicationContext reactContext)</h5><p>当 <code>createContext</code> 调用完毕后，C++ 会回调了 <code>setupReactContextRunnable</code> 线程，该线程调用的就是 <code>setupReactContext</code> 方法。代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactInstanceManager</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupReactContext</span><span class="params">(<span class="keyword">final</span> ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">    Log.d(ReactConstants.TAG, <span class="string">"ReactInstanceManager.setupReactContext()"</span>);</div><div class="line">    ReactMarker.logMarker(PRE_SETUP_REACT_CONTEXT_END);</div><div class="line">    ReactMarker.logMarker(SETUP_REACT_CONTEXT_START);</div><div class="line">    Systrace.beginSection(TRACE_TAG_REACT_JAVA_BRIDGE, <span class="string">"setupReactContext"</span>);</div><div class="line">    <span class="keyword">synchronized</span> (mAttachedRootViews) &#123;</div><div class="line">      <span class="keyword">synchronized</span> (mReactContextLock) &#123;</div><div class="line">        mCurrentReactContext = Assertions.assertNotNull(reactContext);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      CatalystInstance catalystInstance =</div><div class="line">          Assertions.assertNotNull(reactContext.getCatalystInstance());</div><div class="line">      <span class="comment">// 执行Native Java module的初始化</span></div><div class="line">      catalystInstance.initialize();</div><div class="line">      <span class="comment">// 重置DevSupportManager的ReactContext</span></div><div class="line">      mDevSupportManager.onNewReactContextCreated(reactContext);</div><div class="line">      <span class="comment">// 内存状态回调设置</span></div><div class="line">      mMemoryPressureRouter.addMemoryPressureListener(catalystInstance);</div><div class="line">      <span class="comment">// 复位生命周期 (和这个有关 LifecycleState.RESUMED)</span></div><div class="line">      moveReactContextToCurrentLifecycleState();</div><div class="line"></div><div class="line">      ReactMarker.logMarker(ATTACH_MEASURED_ROOT_VIEWS_START);</div><div class="line">      <span class="keyword">for</span> (ReactRootView rootView : mAttachedRootViews) &#123;</div><div class="line">        attachRootViewToInstance(rootView);</div><div class="line">      &#125;</div><div class="line">      ReactMarker.logMarker(ATTACH_MEASURED_ROOT_VIEWS_END);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ReactInstanceEventListener[] listeners =</div><div class="line">      <span class="keyword">new</span> ReactInstanceEventListener[mReactInstanceEventListeners.size()];</div><div class="line">    <span class="keyword">final</span> ReactInstanceEventListener[] finalListeners =</div><div class="line">        mReactInstanceEventListeners.toArray(listeners);</div><div class="line"></div><div class="line">    UiThreadUtil.runOnUiThread(</div><div class="line">        <span class="keyword">new</span> Runnable() &#123;</div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">for</span> (ReactInstanceEventListener listener : finalListeners) &#123;</div><div class="line">              listener.onReactContextInitialized(reactContext);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;);</div><div class="line">    Systrace.endSection(TRACE_TAG_REACT_JAVA_BRIDGE);</div><div class="line">    ReactMarker.logMarker(SETUP_REACT_CONTEXT_END);</div><div class="line">    reactContext.runOnJSQueueThread(</div><div class="line">        <span class="keyword">new</span> Runnable() &#123;</div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            Process.setThreadPriority(Process.THREAD_PRIORITY_DEFAULT);</div><div class="line">            ReactMarker.logMarker(CHANGE_THREAD_PRIORITY, <span class="string">"js_default"</span>);</div><div class="line">          &#125;</div><div class="line">        &#125;);</div><div class="line">    reactContext.runOnNativeModulesQueueThread(</div><div class="line">        <span class="keyword">new</span> Runnable() &#123;</div><div class="line">          <span class="meta">@Override</span></div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            Process.setThreadPriority(Process.THREAD_PRIORITY_DEFAULT);</div><div class="line">          &#125;</div><div class="line">        &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>ReactInstanceManager.attachRootViewToInstance</code> 方法，重置 <code>ReactRootView</code> 内容，然后将ReactRootView作为根布局，作为根布局进行绘制。随后调用 <code>rootView.setRootViewTag(rootTag);</code> 设置内相关内容，调用 <code>rootView.runApplication()</code> 启动 js。</p>
<p><code>rootView.runApplication</code> 里面就是包装了一些启动参数 launchOptions 与 模块名 jsAppModuleName。然后最终调用了 </p>
<p><code>catalystInstance.getJSModule(AppRegistry.class).runApplication(jsAppModuleName, appParams)</code> 方法：</p>
<p>检查下这个代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * JS module interface - main entry point for launching React application for a given key.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AppRegistry</span> <span class="keyword">extends</span> <span class="title">JavaScriptModule</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">runApplication</span><span class="params">(String appKey, WritableMap appParameters)</span></span>;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">unmountApplicationComponentAtRootTag</span><span class="params">(<span class="keyword">int</span> rootNodeTag)</span></span>;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">startHeadlessTask</span><span class="params">(<span class="keyword">int</span> taskId, String taskKey, WritableMap data)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>根据注释我们知道这有可能就是js层暴露给java的接口方法。?? (AppRegister.js)</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ReactNative/" rel="tag">ReactNative</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/18/ReactNative基础3/" rel="next" title="ReactNative 详解(三) 基础内容之小技巧">
                <i class="fa fa-chevron-left"></i> ReactNative 详解(三) 基础内容之小技巧
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/19/单页应用代码分割/" rel="prev" title="单页应用代码分割">
                单页应用代码分割 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="CaelumTian" />
            
              <p class="site-author-name" itemprop="name">CaelumTian</p>
              <p class="site-description motion-element" itemprop="description">你若盛开，清风自来，心若沉浮 浅笑安然</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">27</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/T-phantom" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.linkedin.com/in/caelumtian/" target="_blank" title="LinkIn">
                      
                        <i class="fa fa-fw fa-globe"></i>LinkIn</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="caelumtian@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-globe"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/u/3789103367" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-globe"></i>Weibo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/CaelumTian" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-globe"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://eux.baidu.com" title="百度EUX" target="_blank">百度EUX</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactNative-系统框架概述"><span class="nav-number">1.</span> <span class="nav-text">ReactNative 系统框架概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动流程"><span class="nav-number">2.</span> <span class="nav-text">启动流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#应用初始化"><span class="nav-number">2.1.</span> <span class="nav-text">应用初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用启动流程"><span class="nav-number">2.2.</span> <span class="nav-text">应用启动流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ReactActivityDelegate"><span class="nav-number">2.2.1.</span> <span class="nav-text">ReactActivityDelegate</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ReactActivityDelegate-onCreate-Bundle-savedInstanceState"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">ReactActivityDelegate.onCreate(Bundle savedInstanceState)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ReactRootView-startReactApplication-ReactInstanceManager-reactInstanceManager-String-moduleName-Nullable-Bundle-launchOptions"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">ReactRootView.startReactApplication(ReactInstanceManager reactInstanceManager, String moduleName, @Nullable Bundle launchOptions)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ReactInstanceManager-createReactContextInBackground"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">ReactInstanceManager.createReactContextInBackground()</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CatalystInstanceImpl"><span class="nav-number">2.2.2.</span> <span class="nav-text">CatalystInstanceImpl</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#CatalystInstanceImpl-runJSBundle"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">CatalystInstanceImpl.runJSBundle()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ReactInstanceManager-setupReactContext-final-ReactApplicationContext-reactContext"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">ReactInstanceManager.setupReactContext(final ReactApplicationContext reactContext)</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CaelumTian</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
